<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Mybatis on Barry Blog</title><link>https://barryoo.github.io/blog/mybatis/</link><description>Recent content in Mybatis on Barry Blog</description><generator>Hugo -- gohugo.io</generator><language>en-US</language><copyright>Copyright © 2023, Barry Chen.</copyright><lastBuildDate>Mon, 30 Nov 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://barryoo.github.io/blog/mybatis/index.xml" rel="self" type="application/rss+xml"/><item><title>mybatis TypeHandler原理分析与思考</title><link>https://barryoo.github.io/mybatis-typehandler%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%9D%E8%80%83/</link><pubDate>Mon, 30 Nov 2020 00:00:00 +0000</pubDate><guid>https://barryoo.github.io/mybatis-typehandler%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%9D%E8%80%83/</guid><description>TypeHandler使用 在自定义TypeHandler上注解@MappedTypes(value = {A.class, B.class}) 配置typeHandlersPackage. 包下的所有TypeHandler都会被自动注册. Mapper.xml中声明&amp;lt;result column=&amp;quot;enum1&amp;quot; jdbcType=&amp;quot;INTEGER&amp;quot; typeHandler=&amp;quot;xxx&amp;quot;/&amp;gt; mybatis配置文件 &amp;lt;typeHandlers&amp;gt; &amp;lt;typeHandler handler=&amp;#34;com.xxx.handler.EnumTypeHandler&amp;#34;/&amp;gt; &amp;lt;/typeHandlers&amp;gt; TypeHandler工作原理 自动注册JavaType的所有默认TypeHandler. 见TypeHandlerRegistry 虽然Enum不是JavaType, 但是会自动设置默认的EnumTypeHandler. 在根据javaType获取TypeHandler的时候, 会判断class是否是enum, 如果是, 则会生成该enum专用的EnumTypeHandler TypeHandler注册时,需要寻找对应的JavaType. 如果已经指定JavaType, 则直接可以注册 如果没有指定, 则尝试通过@MappedTypes注解, 找到JavaType 如果依然找不到JavaType, 则判断该TypeHandler是否继承TypeReference&amp;lt;T&amp;gt;,通过getSuperclassTypeParameter方法,可以得到泛型的JavaType. 如果依然找不到JavaType, 则JavaType为null,进行注册. preparedStatement设值时, 调用来字段对应的HandlerType,进行转换. 查询数据库结果后, 调用字段对应的HandlerType.setResult. mybatis中对于Enum的类型处理 使用者什么都不用做, 自动支持.
mybatis提供了EnumTypeHandler和EnumOrdinalTypeHandler.
EnumTypeHandler: 调用Enum.name()方法, 将枚举转换为String. EnumOrdinalTypeHandler: 调用Enum.ordinal()方法, 将枚举转换为int. 当需要转换枚举类型时, 优先使用缓存中的TypeHandler, 如果没有找到, 则实时生成专用的EnumTypeHandler.
MybatisPlusEnumTypeHandler MybatisPlus通过MybaitsEnumTypeHandler增强对enum的支持,允许指定转换时使用的字段.
使用 配置mybatis-plus.defaultEnumTypeHandler, 默认是org.apache.ibatis.type.EnumTypeHandler, 可以不配置. 如果想要在初始化时, 创建TypeHandler, 有两种方式 配置mybatis-plus.type-enums-package. 自动为该包下的所有enum,注册MybatisPlusEnumTypeHandler. 在model中为枚举字段注解@TableField(typeHandler = xxx), 为该枚举,注册指定的TypeHandler. 如果想要在使用时, 实时创建Typehandler. 枚举实现IEnum接口,或者为想要序列化的字段设置@EnumValue注解.</description></item></channel></rss>