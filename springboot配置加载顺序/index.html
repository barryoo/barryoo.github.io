<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://barryoo.github.io/favicon.ico><title>springBoot配置加载顺序 | Barry Blog</title>
<meta name=title content="springBoot配置加载顺序"><meta name=description content="参考 https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config spring2.0与3.0版本的加载顺序不一致, 差异在于config data file的加载顺序不同.
注意: 请以springboot启动流程中配置文件的加载顺序,后加载覆盖先加载来考虑,而不是配置的优先级来考虑. 这样会得到更准确的结果, 也更符合直觉.
PropertySource顺序 加载顺序如下, 下面的覆盖上面的.
Default properties (specified by setting SpringApplication.setDefaultProperties).
@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.
Config data (such as application.properties files)."><meta name=keywords content="spring,springboot,"><meta property="og:title" content="springBoot配置加载顺序"><meta property="og:description" content="参考 https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config spring2.0与3.0版本的加载顺序不一致, 差异在于config data file的加载顺序不同.
注意: 请以springboot启动流程中配置文件的加载顺序,后加载覆盖先加载来考虑,而不是配置的优先级来考虑. 这样会得到更准确的结果, 也更符合直觉.
PropertySource顺序 加载顺序如下, 下面的覆盖上面的.
Default properties (specified by setting SpringApplication.setDefaultProperties).
@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.
Config data (such as application.properties files)."><meta property="og:type" content="article"><meta property="og:url" content="https://barryoo.github.io/springboot%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F/"><meta property="og:image" content="https://barryoo.github.io/images/share.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-03-10T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-10T00:00:00+00:00"><meta property="og:site_name" content="barry blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://barryoo.github.io/images/share.png"><meta name=twitter:title content="springBoot配置加载顺序"><meta name=twitter:description content="参考 https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config spring2.0与3.0版本的加载顺序不一致, 差异在于config data file的加载顺序不同.
注意: 请以springboot启动流程中配置文件的加载顺序,后加载覆盖先加载来考虑,而不是配置的优先级来考虑. 这样会得到更准确的结果, 也更符合直觉.
PropertySource顺序 加载顺序如下, 下面的覆盖上面的.
Default properties (specified by setting SpringApplication.setDefaultProperties).
@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.
Config data (such as application.properties files)."><meta itemprop=name content="springBoot配置加载顺序"><meta itemprop=description content="参考 https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config spring2.0与3.0版本的加载顺序不一致, 差异在于config data file的加载顺序不同.
注意: 请以springboot启动流程中配置文件的加载顺序,后加载覆盖先加载来考虑,而不是配置的优先级来考虑. 这样会得到更准确的结果, 也更符合直觉.
PropertySource顺序 加载顺序如下, 下面的覆盖上面的.
Default properties (specified by setting SpringApplication.setDefaultProperties).
@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.
Config data (such as application.properties files)."><meta itemprop=datePublished content="2023-03-10T00:00:00+00:00"><meta itemprop=dateModified content="2023-03-10T00:00:00+00:00"><meta itemprop=wordCount content="223"><meta itemprop=image content="https://barryoo.github.io/images/share.png"><meta itemprop=keywords content="spring,springboot,"><meta name=referrer content="no-referrer-when-downgrade"><style>html{scroll-behavior:smooth}body{font-family:Verdana,sans-serif;margin:auto;padding:20px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}header{margin:auto;text-align:center;max-width:720px}.menu{justify-content:space-between;display:flex}main{margin:0 auto}.blog-posts-container{width:fit-content;margin:auto}.tag-container{max-width:720px}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0;text-align:center;color:#000;font-size:25px}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}.toc{max-width:250px;width:auto;top:20%;position:fixed;font-size:13px}.toc a{color:rgba(128,128,128,.4);text-decoration:none;display:block}.toc a:hover{color:#777}article{max-width:1080px;margin:0 auto;margin-left:calc(max((100% - 1080px)/2,250px))}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li span{margin-right:30px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}@media only screen and (max-width:1020px){.toc{width:auto;position:relative}article{padding-left:0;margin:0 auto}}</style></head><body><header><nav class=menu><a id=siteTitle href=/ class=title>Barry Blog</a><div style=display:flex><a href=/>Home</a>
<a href=https://github.com/barryOO>github</a>
<a href=/blog/>Blog</a></div></nav></header><main><aside class=toc><a href=#siteTitle style=margin-left:40px>top</a><nav id=TableOfContents><ul><li><a href=#参考>参考</a></li><li><a href=#propertysource顺序>PropertySource顺序</a></li><li><a href=#config-data-file-加载>config data file 加载</a><ul><li><a href=#优先级原则>优先级原则</a></li><li><a href=#位置顺序>位置顺序</a></li></ul></li><li><a href=#举例>举例</a></li></ul></nav></aside><article><h1 style=font-size:40px>springBoot配置加载顺序</h1><p><i><time datetime=2023-03-10 pubdate>10 Mar, 2023</time></i></p><p><a href=https://barryoo.github.io/blog/spring/>#spring</a>
<a href=https://barryoo.github.io/blog/springboot/>#springboot</a></p><content><h2 id=参考>参考</h2><p><a href=https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config>https://docs.spring.io/spring-boot/docs/2.3.9.RELEASE/reference/htmlsingle/#boot-features-external-config</a>
<a href=https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config>https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config</a>
spring2.0与3.0版本的加载顺序不一致, 差异在于config data file的加载顺序不同.</p><p>注意: 请以springboot启动流程中<code>配置文件的加载顺序,后加载覆盖先加载</code>来考虑,而不是<code>配置的优先级</code>来考虑. 这样会得到更准确的结果, 也更符合直觉.</p><h2 id=propertysource顺序>PropertySource顺序</h2><p>加载顺序如下, 下面的覆盖上面的.</p><p>Default properties (specified by setting SpringApplication.setDefaultProperties).</p><p>@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.</p><p>Config data (such as application.properties files).</p><p>A RandomValuePropertySource that has properties only in random.*.</p><p>OS environment variables.</p><p>Java System properties (System.getProperties()).</p><p>JNDI attributes from java:comp/env.</p><p>ServletContext init parameters.</p><p>ServletConfig init parameters.</p><p>Properties from SPRING_APPLICATION_JSON (inline JSON embedded in an environment variable or system property).</p><p>Command line arguments.</p><p>properties attribute on your tests. Available on @SpringBootTest and the test annotations for testing a particular slice of your application.</p><p>@DynamicPropertySource annotations in your tests.</p><p>@TestPropertySource annotations on your tests.</p><p>Devtools global settings properties in the $HOME/.config/spring-boot directory when devtools is active.</p><h2 id=config-data-file-加载>config data file 加载</h2><p>对上面第3点的细化.</p><h3 id=优先级原则>优先级原则</h3><p>以下原则也有优先级, 优先级依此降低.</p><ul><li>bootstrap > application, 由于spring-boot启动时,会先用bootstrap中的配置文件初始化上下文, 在用application初始化子上下文,所以在springboot的整体流程上,bootstrap优先被使用. 但是这不意味着bootstrap中的配置优先级高于application中的配置, 事实上,除了在启动流程上导致的优先级不同, 在我们使用普通配置时, application配置的优先级高于bootstrap, 因为application被后加载,所以会覆盖bootstrap中的配置.</li><li>profile > 非profile, 与文件目录无关. 所有的profile文件永远优先于非profile文件.</li><li>位置优先级,见下面</li><li>同一目录下, properties > yml > yaml</li></ul><h3 id=位置顺序>位置顺序</h3><p>加载顺序如下, 下面的覆盖上面的.
classpath/
classpath/config/
jar包所在目录/
jar包所在目录/config/</p><h2 id=举例>举例</h2><p>假设当前目录为 app/test.jar, 则文件加载的顺序如下, 下面的覆盖上面的.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span># 硬编码的配置
</span></span><span style=display:flex><span>@PropertySource
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 配置文件:先加载非profile
</span></span><span style=display:flex><span>app/test.jar/classpath/application.properties/yml/yaml
</span></span><span style=display:flex><span>app/test.jar/classpath/config/application.properties/yml/yaml
</span></span><span style=display:flex><span>app/application.properties
</span></span><span style=display:flex><span>app/config/application.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 配置文件:再加载profile
</span></span><span style=display:flex><span>app/test.jar/classpath/application-profile.properties/yml/yaml
</span></span><span style=display:flex><span>app/app/test.jar/classpath/config/application-profile.properties/yml/yaml
</span></span><span style=display:flex><span>app/application-profile.properties
</span></span><span style=display:flex><span>app/config/application-profile.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># 运行时指定的配置
</span></span><span style=display:flex><span>操作系统环境变量中的配置
</span></span><span style=display:flex><span>JVM系统属性中的配置
</span></span><span style=display:flex><span>JNDI attributes from java:comp/env.
</span></span><span style=display:flex><span>执行命令传入的配置
</span></span><span style=display:flex><span>properties attribute on tests
</span></span></code></pre></div></content></article></main><footer></footer></body></html>